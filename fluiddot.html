<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fluid Color Diffusion (Light Canvas)</title>
    <style>
      body {
        background-color: #f8f8f8; /* Changed to light background */
        color: #333; /* Dark text for contrast */
        font-family: "Inter", sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        margin: 0;
        padding: 20px;
      }
      .container {
        display: flex;
        flex-direction: column;
        gap: 20px;
        width: 90%;
        max-width: 1000px;
      }
      #colorCanvas {
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); /* Lighter shadow for light background */
        width: 100%;
        height: 50vh;
        min-height: 300px;
      }
      .palette {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        padding: 10px;
        background: #e9e9e9; /* Lighter palette background */
        border-radius: 8px;
      }
      .color-button {
        width: 50px;
        height: 50px;
        border: 3px solid #ccc; /* Lighter border */
        border-radius: 50%;
        cursor: pointer;
        transition: transform 0.1s ease, box-shadow 0.2s ease;
      }
      .color-button:hover {
        transform: scale(1.1);
        box-shadow: 0 0 15px currentColor;
        border-color: currentColor;
      }
      h1 {
        color: #333;
        margin-bottom: 10px;
        font-size: 1.5rem;
      }
      p {
        color: #555;
        margin-top: 0;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Fluid Color Diffusion (Light Canvas)</h1>
      <p>
        Click a color to drop a soft splash of ink onto the white canvas. Watch
        the gentle blending!
      </p>

      <canvas id="colorCanvas"></canvas>

      <div class="palette" id="colorPalette">
        <!-- Color buttons will be generated here by JavaScript -->
      </div>
    </div>

    <script>
      const canvas = document.getElementById("colorCanvas");
      const ctx = canvas.getContext("2d");
      const paletteContainer = document.getElementById("colorPalette");

      // --- Configuration ---
      const colorList = {
        // UPDATED: Brighter, more vibrant color selection
        "Vibrant Red": "#FF3B30", // Brighter, high-saturation red
        "Electric Blue": "#007AFF", // Rich, primary blue
        "Lush Green": "#34C759", // Saturated green
        "Sunny Yellow": "#FFCC00", // Brighter yellow
        "Magenta Purple": "#AF52DE", // Vibrant purple
        "Warm Orange": "#FF9500", // Clear orange
        "Pure White": "#FFFFFF",
        "Deep Black": "#050505",
      };

      // Settings for the diffusion effect
      const INITIAL_RADIUS = 5; // Starting size of the drop
      const GROWTH_RATE = 2.5; // How fast the drop expands per frame
      const MAX_LIFESPAN = 8000; // Time (in frames) before the splash is cleaned up

      // --- State Management ---
      let drops = [];
      const BASE_COLOR_HEX = "#e9e9e9";

      // --- Utility Functions ---

      function hexToRgb(hex) {
        const bigint = parseInt(hex.slice(1), 16);
        const r = (bigint >> 16) & 255;
        const g = (bigint >> 8) & 255;
        const b = bigint & 255;
        return [r, g, b];
      }

      // --- Core Application Logic ---

      function resizeCanvas() {
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;

        ctx.fillStyle = BASE_COLOR_HEX;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }

      function generatePalette() {
        for (const name in colorList) {
          const hex = colorList[name];
          const button = document.createElement("div");
          button.className = "color-button";
          button.title = name;
          button.style.backgroundColor = hex;
          button.style.color = hex;

          button.addEventListener("click", () => {
            const targetRgb = hexToRgb(hex);
            const maxDim = Math.min(canvas.width, canvas.height);

            const newDrop = {
              x: Math.random() * canvas.width,
              y: Math.random() * canvas.height,
              color: targetRgb,
              currentRadius: INITIAL_RADIUS,
              maxRadius: maxDim * (0.3 + Math.random() * 0.4),
              age: 0,
              lifespan: MAX_LIFESPAN,
            };
            drops.push(newDrop);
          });
          paletteContainer.appendChild(button);
        }
      }

      function draw() {
        // 1. Fill the canvas with the base color (the white/light gray)
        ctx.fillStyle = BASE_COLOR_HEX;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 2. Blend mode for overlapping colors
        ctx.globalCompositeOperation = "source-over";

        drops.forEach((drop) => {
          drop.currentRadius = Math.min(
            drop.currentRadius + GROWTH_RATE,
            drop.maxRadius
          );
          drop.age++;

          // MODIFICATION: Softened Initial Opacity
          const relativeAge = drop.age / drop.lifespan;

          // Opacity starts at MAX_INITIAL_OPACITY (e.g., 0.5) and linearly fades over time
          const MAX_INITIAL_OPACITY = 0.5;
          let opacity = MAX_INITIAL_OPACITY * (1 - relativeAge);

          // Ensure minimum visibility for long-term layering (e.g., 5% visibility)
          opacity = Math.max(0.05, opacity);

          const [r, g, b] = drop.color;

          // --- Create Radial Gradient for Diffusion ---
          const gradient = ctx.createRadialGradient(
            drop.x,
            drop.y,
            drop.currentRadius * 0.05,
            drop.x,
            drop.y,
            drop.currentRadius
          );

          // Gradient stops are now based on the calculated 'soft' opacity
          gradient.addColorStop(0, `rgba(${r}, ${g}, ${b}, ${opacity})`);
          gradient.addColorStop(
            0.8,
            `rgba(${r}, ${g}, ${b}, ${opacity * 0.4})`
          );
          gradient.addColorStop(1, `rgba(${r}, ${g}, ${b}, 0)`);

          ctx.fillStyle = gradient;
          ctx.beginPath();
          ctx.arc(drop.x, drop.y, drop.currentRadius, 0, Math.PI * 2);
          ctx.fill();
        });

        // 3. Clean up drops that have exceeded their lifespan
        drops = drops.filter((drop) => drop.age < drop.lifespan);

        // 4. Loop
        requestAnimationFrame(draw);
      }

      // --- Initialization ---

      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();
      generatePalette();

      draw();
    </script>
  </body>
</html>
